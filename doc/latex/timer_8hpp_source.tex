\doxysection{timer.\+hpp}
\hypertarget{timer_8hpp_source}{}\label{timer_8hpp_source}\index{src/timer.hpp@{src/timer.hpp}}
\mbox{\hyperlink{timer_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ TIMER\_HPP}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ TIMER\_HPP}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <sstream>}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <chrono>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{common_8hpp}{common.hpp}}"{}}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{keyword}{class\ }\textcolor{keyword}{alignas}(64)\ \mbox{\hyperlink{classtimer}{timer}}\ :\ \textcolor{keyword}{public}\ std::enable\_shared\_from\_this<timer>\ \{}
\DoxyCodeLine{00013\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00014\ \ \ std::vector<double>\ \mbox{\hyperlink{classtimer_add9bb56e90041a97e438b6e391bca695}{times}};}
\DoxyCodeLine{00015\ \ \ std::vector<std::string>\ \mbox{\hyperlink{classtimer_a368568f1d2add51c5ee0744beb8e9a1c}{names}};}
\DoxyCodeLine{00016\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classtimer_a40f654ad79b85c95aa662605f9d24684}{current\_section}}\ =\ -\/1;}
\DoxyCodeLine{00017\ \ \ std::chrono::time\_point<std::chrono::high\_resolution\_clock>\ \mbox{\hyperlink{classtimer_a02cf6e7425662939b87cfd357a83cd3f}{t\_last}};}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \ \ \mbox{\hyperlink{classtimer_ae536faf93e02933cd025a6fbcbb48d0a}{timer}}()\ \{\}}
\DoxyCodeLine{00020\ \ \ \mbox{\hyperlink{classtimer_a65fe2c1bbf1af5fe716a69212237e746}{timer}}(std::vector<std::string>\ \mbox{\hyperlink{classtimer_a368568f1d2add51c5ee0744beb8e9a1c}{names}})\ :\ \mbox{\hyperlink{classtimer_add9bb56e90041a97e438b6e391bca695}{times}}(\mbox{\hyperlink{classtimer_a368568f1d2add51c5ee0744beb8e9a1c}{names}}.size(),\ 0),\ \mbox{\hyperlink{classtimer_a368568f1d2add51c5ee0744beb8e9a1c}{names}}(\mbox{\hyperlink{classtimer_a368568f1d2add51c5ee0744beb8e9a1c}{names}})\ \{\ \}}
\DoxyCodeLine{00021\ \ \ }
\DoxyCodeLine{00022\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtimer_a66fc54d1f33bd9d4bec5f8d563595c2e}{reset}}()\ \{}
\DoxyCodeLine{00023\ \ \ \ \ std::fill(\mbox{\hyperlink{classtimer_add9bb56e90041a97e438b6e391bca695}{times}}.begin(),\ \mbox{\hyperlink{classtimer_add9bb56e90041a97e438b6e391bca695}{times}}.end(),\ 0);}
\DoxyCodeLine{00024\ \ \ \}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classtimer_a7ef48e9e3a1286fe82e00f7730000c24}{get\_index\_from\_name}}(std::string\ s)\ \{}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{keywordtype}{int}\ i\ =\ std::find(\mbox{\hyperlink{classtimer_a368568f1d2add51c5ee0744beb8e9a1c}{names}}.begin(),\ \mbox{\hyperlink{classtimer_a368568f1d2add51c5ee0744beb8e9a1c}{names}}.end(),\ s)\ -\/\ \mbox{\hyperlink{classtimer_a368568f1d2add51c5ee0744beb8e9a1c}{names}}.begin();}
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ (\textcolor{keywordtype}{int})\mbox{\hyperlink{classtimer_a368568f1d2add51c5ee0744beb8e9a1c}{names}}.size())}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \mbox{\hyperlink{classtimer_a368568f1d2add51c5ee0744beb8e9a1c}{names}}.push\_back(s),\ \mbox{\hyperlink{classtimer_add9bb56e90041a97e438b6e391bca695}{times}}.push\_back(0);}
\DoxyCodeLine{00030\ \ \ \ \ \textcolor{keywordflow}{return}\ i;}
\DoxyCodeLine{00031\ \ \ \}}
\DoxyCodeLine{00032\ \ \ }
\DoxyCodeLine{00033\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtimer_a18f8a788c6c30c041dfcbe813781bc02}{start\_section}}(\textcolor{keywordtype}{int}\ i)\ \{}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keyword}{auto}\ t\ =\ std::chrono::high\_resolution\_clock::now();}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keywordtype}{double}\ dt\ =\ std::chrono::duration\_cast<std::chrono::nanoseconds>(t\ -\/\ \mbox{\hyperlink{classtimer_a02cf6e7425662939b87cfd357a83cd3f}{t\_last}}).count();}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classtimer_a40f654ad79b85c95aa662605f9d24684}{current\_section}}\ >=\ 0)}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \mbox{\hyperlink{classtimer_add9bb56e90041a97e438b6e391bca695}{times}}[\mbox{\hyperlink{classtimer_a40f654ad79b85c95aa662605f9d24684}{current\_section}}]\ +=\ dt;}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00040\ \ \ \ \ \mbox{\hyperlink{classtimer_a02cf6e7425662939b87cfd357a83cd3f}{t\_last}}\ =\ t;}
\DoxyCodeLine{00041\ \ \ \ \ \mbox{\hyperlink{classtimer_a40f654ad79b85c95aa662605f9d24684}{current\_section}}\ =\ i;}
\DoxyCodeLine{00042\ \ \ \}}
\DoxyCodeLine{00043\ \ \ \ \ }
\DoxyCodeLine{00044\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtimer_aa0e06fefb79f8f81536b3d39fb4872ed}{end\_section}}()\ \{}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keyword}{auto}\ t\ =\ std::chrono::high\_resolution\_clock::now();}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordtype}{double}\ dt\ =\ std::chrono::duration\_cast<std::chrono::nanoseconds>(t\ -\/\ \mbox{\hyperlink{classtimer_a02cf6e7425662939b87cfd357a83cd3f}{t\_last}}).count();}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classtimer_a40f654ad79b85c95aa662605f9d24684}{current\_section}}\ >=\ 0)}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \mbox{\hyperlink{classtimer_add9bb56e90041a97e438b6e391bca695}{times}}[\mbox{\hyperlink{classtimer_a40f654ad79b85c95aa662605f9d24684}{current\_section}}]\ +=\ dt;}
\DoxyCodeLine{00049\ \ \ \ \ \mbox{\hyperlink{classtimer_a40f654ad79b85c95aa662605f9d24684}{current\_section}}\ =\ -\/1;}
\DoxyCodeLine{00050\ \ \ \}}
\DoxyCodeLine{00051\ \ \ \ \ }
\DoxyCodeLine{00052\ \ \ std::string\ \mbox{\hyperlink{classtimer_ac64933666fb00ec9856cb9d66567387a}{format\_times}}(std::string\ sep\ =\ \textcolor{stringliteral}{"{},\ "{}})\ \{}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keyword}{auto}\ t\ =\ std::chrono::high\_resolution\_clock::now();}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordtype}{double}\ dt\ =\ std::chrono::duration\_cast<std::chrono::nanoseconds>(t\ -\/\ \mbox{\hyperlink{classtimer_a02cf6e7425662939b87cfd357a83cd3f}{t\_last}}).count();}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classtimer_a40f654ad79b85c95aa662605f9d24684}{current\_section}}\ >=\ 0)}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \mbox{\hyperlink{classtimer_add9bb56e90041a97e438b6e391bca695}{times}}[\mbox{\hyperlink{classtimer_a40f654ad79b85c95aa662605f9d24684}{current\_section}}]\ +=\ dt;}
\DoxyCodeLine{00057\ \ \ \ \ }
\DoxyCodeLine{00058\ \ \ \ \ std::stringstream\ ss;}
\DoxyCodeLine{00059\ \ \ \ \ ss\ <<\ \mbox{\hyperlink{classtimer_a368568f1d2add51c5ee0744beb8e9a1c}{names}}[0]\ <<\ \textcolor{stringliteral}{"{}:\ "{}}\ <<\ \mbox{\hyperlink{classtimer_add9bb56e90041a97e438b6e391bca695}{times}}[0]\ *\ 1e-\/6\ <<\ \textcolor{stringliteral}{"{}ms"{}};}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 1;\ i\ <\ (int)\mbox{\hyperlink{classtimer_add9bb56e90041a97e438b6e391bca695}{times}}.size();\ i++)}
\DoxyCodeLine{00061\ \ \ \ \ \ \ ss\ <<\ sep\ <<\ \mbox{\hyperlink{classtimer_a368568f1d2add51c5ee0744beb8e9a1c}{names}}[i]\ <<\ \textcolor{stringliteral}{"{}:\ "{}}\ <<\ \mbox{\hyperlink{classtimer_add9bb56e90041a97e438b6e391bca695}{times}}[i]\ *\ 1e-\/6\ <<\ \textcolor{stringliteral}{"{}ms"{}};}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keywordflow}{return}\ ss.str();}
\DoxyCodeLine{00063\ \ \ \}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \mbox{\hyperlink{classtimer}{timer}}\ \&\mbox{\hyperlink{classtimer_afbb4aa9f81674de8b81efdde0f0bbf40}{operator+=}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classtimer}{timer}}\ \&to)\ \{}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ (int)to.\mbox{\hyperlink{classtimer_a368568f1d2add51c5ee0744beb8e9a1c}{names}}.size();\ ++i)\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ j\ =\ \mbox{\hyperlink{classtimer_a7ef48e9e3a1286fe82e00f7730000c24}{get\_index\_from\_name}}(to.\mbox{\hyperlink{classtimer_a368568f1d2add51c5ee0744beb8e9a1c}{names}}[i]);}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \mbox{\hyperlink{classtimer_add9bb56e90041a97e438b6e391bca695}{times}}[j]\ +=\ to.\mbox{\hyperlink{classtimer_add9bb56e90041a97e438b6e391bca695}{times}}[i];}
\DoxyCodeLine{00070\ \ \ \ \ \}}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00072\ \ \ \}}
\DoxyCodeLine{00073\ \ \ \textcolor{keyword}{friend}\ \mbox{\hyperlink{classtimer}{timer}}\ \mbox{\hyperlink{classtimer_a7bb3d0e26e601a9990d26a4f377f6b17}{operator+}}(\mbox{\hyperlink{classtimer}{timer}}\ lhs,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classtimer}{timer}}\ \&rhs)\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keywordflow}{return}\ lhs\ +=\ rhs;}
\DoxyCodeLine{00075\ \ \ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \textcolor{keyword}{static}\ py::tuple\ \mbox{\hyperlink{classtimer_af9dd0dea904e185c54365e14de45b16e}{pickle}}(std::shared\_ptr<timer>\ s)\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \ \textcolor{keywordflow}{return}\ py::make\_tuple(s-\/>times,\ s-\/>names);}
\DoxyCodeLine{00079\ \ \ \ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \textcolor{keyword}{static}\ std::shared\_ptr<timer>\ \mbox{\hyperlink{classtimer_a60123aa8e27d1b7dcc52bcafadf422c8}{unpickle}}(py::tuple\ t)\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t.size()\ !=\ 2)}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}invalid\ state\ in\ timer::unpickle"{}});}
\DoxyCodeLine{00084\ \ \ \ \ \ }
\DoxyCodeLine{00085\ \ \ \ \ \ \textcolor{keyword}{auto}\ res\ =\ std::make\_shared<timer>(t[1].cast<std::vector<std::string>>());}
\DoxyCodeLine{00086\ \ \ \ \ \ res-\/>times\ =\ t[0].cast<std::vector<double>>();}
\DoxyCodeLine{00087\ \ \ \ \ \ \textcolor{keywordflow}{return}\ res;}
\DoxyCodeLine{00088\ \ \ \}}
\DoxyCodeLine{00089\ \ }
\DoxyCodeLine{00090\ \ \ }
\DoxyCodeLine{00091\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtimer_ac5812163425a6f425a1a24848fe3ba83}{bind}}(py::module\_\ \&m)\ \{}
\DoxyCodeLine{00092\ \ \ \ \ py::class\_<timer,\ std::shared\_ptr<timer>>(m,\ \textcolor{stringliteral}{"{}Timer"{}})}
\DoxyCodeLine{00093\ \ \ \ \ \ \ .def(py::init<std::vector<std::string>>(),\ py::arg(\textcolor{stringliteral}{"{}names"{}}))}
\DoxyCodeLine{00094\ \ \ \ \ \ \ .def\_readonly(\textcolor{stringliteral}{"{}names"{}},\ \&\mbox{\hyperlink{classtimer_a368568f1d2add51c5ee0744beb8e9a1c}{timer::names}})}
\DoxyCodeLine{00095\ \ \ \ \ \ \ .def\_readonly(\textcolor{stringliteral}{"{}times"{}},\ \&\mbox{\hyperlink{classtimer_add9bb56e90041a97e438b6e391bca695}{timer::times}})}
\DoxyCodeLine{00096\ \ \ \ \ \ \ .def(\textcolor{stringliteral}{"{}get\_index\_from\_name"{}},\ \&\mbox{\hyperlink{classtimer_a7ef48e9e3a1286fe82e00f7730000c24}{timer::get\_index\_from\_name}})}
\DoxyCodeLine{00097\ \ \ \ \ \ \ .def(\textcolor{stringliteral}{"{}start\_section"{}},\ \&\mbox{\hyperlink{classtimer_a18f8a788c6c30c041dfcbe813781bc02}{timer::start\_section}})}
\DoxyCodeLine{00098\ \ \ \ \ \ \ .def(\textcolor{stringliteral}{"{}end\_section"{}},\ \&\mbox{\hyperlink{classtimer_aa0e06fefb79f8f81536b3d39fb4872ed}{timer::end\_section}})}
\DoxyCodeLine{00099\ \ \ \ \ \ \ .def(\textcolor{stringliteral}{"{}format\_times"{}},\ \&\mbox{\hyperlink{classtimer_ac64933666fb00ec9856cb9d66567387a}{timer::format\_times}})}
\DoxyCodeLine{00100\ \ \ \ \ \ \ .def(py::pickle(\&\mbox{\hyperlink{classtimer_af9dd0dea904e185c54365e14de45b16e}{timer::pickle}},\ \&\mbox{\hyperlink{classtimer_a60123aa8e27d1b7dcc52bcafadf422c8}{timer::unpickle}}))}
\DoxyCodeLine{00101\ \ \ \ \ \ \ .def(py::self\ +\ py::self)}
\DoxyCodeLine{00102\ \ \ \ \ \ \ .def(py::self\ +=\ py::self)}
\DoxyCodeLine{00103\ \ \ \ \ \ \ .def(\textcolor{stringliteral}{"{}\_\_repr\_\_"{}},\ [](std::shared\_ptr<timer>\ t)\{\ \textcolor{keywordflow}{return}\ t-\/>format\_times(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});\ \});}
\DoxyCodeLine{00104\ \ \ \}}
\DoxyCodeLine{00105\ \};}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ }

\end{DoxyCode}
